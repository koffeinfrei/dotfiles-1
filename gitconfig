# vim: ft=gitconfig

[core]
  pager = less -X

[protocol]
  version = 2

[user]
  name = Markus Koller
  email = markus-koller@gmx.ch
  signingKey = DEEC7546D0A869C5AFDFD34AEC9A8B44C0635CE2

[includeIf "gitdir:~/src/gitlab/"]
  path = .gitconfig.gitlab

[color]
  ui = auto

[color "diff"]
  meta = yellow
  frag = magenta bold
  commit = yellow bold
  old = red bold
  new = green bold
  whitespace = red reverse

[color "diff-highlight"]
  oldNormal = red bold
  oldHighlight = red bold 52
  newNormal = green bold
  newHighlight = green bold 22

[advice]
  pushUpdateRejected = false
  statusHints = false
  commitBeforeMerge = false
  resolveConflict = false

[commit]
  gpgSign = true

[diff]
  algorithm = histogram
  renames = copies
  mnemonicprefix = true
  ignoreSubmodules = dirty
  renameLimit = 10000

[difftool]
  prompt = false

[diff-so-fancy]
  markEmptyLines = false

[fetch]
  prune = true

[log]
  abbrevCommit = true
  decorate = true

[merge]
  stat = true
  tool = vimdiff

[mergetool]
  prompt = false
  keepBackup = false

[mergetool.gvimdiff]
  trustExitCode = false

[pager]
  log = diff-so-fancy | less -X
  show = diff-so-fancy | less -X
  diff = diff-so-fancy | less -X
  branch = less -FX

[pull]
  rebase = true

[rebase]
  autosquash = true
  stat = true

[stash]
  showPatch = true
  showStat = true

[submodule]
  fetchJobs = 0

[alias]
  s = status -sb
  st = status
  sta = -c diff.ignoreSubmodules=none st
  ss = !git --no-pager show --stat

  l = log --pretty=format:\"%C(yellow)[%h]%Creset %C(037)%an:%Creset %C(white)%s%Creset%C(auto)%d%Creset %C(black)%ar%Creset\"
  rl = reflog --date=format:%T --pretty=format:\"%C(yellow)[%h]%Creset %C(037)%gD:%Creset %C(white)%gs%Creset%C(auto)%d%Creset\"
  ls = "!cd ${GIT_PREFIX:-.} && git l --stat"
  ld = log -p
  ldf = ld --follow
  lg = l --graph
  news = l ORIG_HEAD..

  di = diff
  dc = diff --cached
  dh = diff HEAD

  c = "!f() { [ $# -gt 0 ] && exec git checkout "$@"; branch=$( git branches 2>/dev/null | fzf +s --no-multi --prompt 'Branches> ' ) && git checkout "$branch"; }; f"
  co = c
  b = rev-parse --abbrev-ref HEAD
  branches = "!git -c color.ui=always branch -a | grep -Ev '(/HEAD|/master)' | sed -r -e 's,^[\\* ]*,,' -e 's,remotes/[^/]+/,,'"
  cm = checkout master
  cd = checkout development

  lb = branch -avv
  cb = create-branch
  db = delete-branch
  bcontains = branch -a --contains

  ap = add -p
  all = add -A
  unstage = reset HEAD -p
  discard = checkout -p

  ci = commit -v
  ca = ci -a
  amend = ci --amend
  reword = amend --only
  extend = amend --no-edit
  fixup = !sha=$( git -c color.ui=always l -n 1000 | fzf +s --no-multi --prompt 'Fixup> ' ) && git commit --fixup "$( echo "$sha" | cut -d[ -f2 | cut -d] -f1 )"
  initial = commit --allow-empty -m 'Initial commit'

  r = remote -v
  shallow = clone --depth 1

  up = pull
  ff = merge --ff-only HEAD@{u}
  re = !OVERCOMMIT_DISABLE=1 git rebase
  ri = re -i
  rem = re master
  rim = ri master
  red = re development
  rid = ri development
  rcontinue = re --continue
  rabort = re --abort
  solve = mergetool
  pom = up origin master
  pick = !OVERCOMMIT_DISABLE=1 git cherry-pick

  pu = push -v
  pua  = -c push.default=matching push -v --progress
  poof = pu --force-with-lease
  pusu = -c push.default=current pu --set-upstream
  puci = pusu -o ci.skip

  sub = submodule
  checkout-submodules = submodule update -q --init
  cos = checkout-submodules

  sts = stash push -k
  stp = stash pop
  std = "!git stash drop && git stl"
  stw = "!cd ${GIT_PREFIX:-.} && git --no-pager -c color.ui=always stash show"
  stl = "!cd ${GIT_PREFIX:-.} && git --no-pager -c color.ui=always stash list"

  # shell wrappers for src_alias
  sh = "!f() { [ $# -gt 0 ] && \"$@\"; }; f"
  bash = "!f() { [ $# -gt 0 ] && bash -ic \"$@\"; }; f"
  rg = !rg
  rake  = !rake
  rails = !rails
  guard = !guard
  cap = !cap
  mux = !mux
  vi = !vi
  vim = !vim
  ed = !git edit

  # try to run a GUI, or tig on terminals
  g = "!f() { if [ \"`uname -s`\" = 'Darwin' ]; then (gitx $@ &>/dev/null &); elif [ -n \"$DISPLAY\" ]; then (gitg $@ &>/dev/null &); else tig $@; fi; }; f"
